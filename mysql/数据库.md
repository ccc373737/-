###1.数据库三范式

- 列不可再分
- 行可以唯一区分
- 表的非主属性不能依赖于其他表的非主属性

###2.事务

ACID 一致性 隔离性 原子性 持久性

###3.数据库引擎

- innoDb：支持事务，支持行锁，聚簇索引

- MyIsam：非聚簇索引，不支持事务，只有表锁，支持全文索引，count计数时快，因为会有一个变量直接缓存住数量

###4.避免死锁

设置超时时间，避免事务交叉，合并多个事务，使用低隔离级别

###5.索引

b+树：中间节点只存索引，不放数据，所有数据都在叶子节点上，底层叶子使用链表结构。

- 查询稳定
- 中间节点只存索引，理论上索引文件可以很大
- 底层使用链表结构，适合区间查询
---

- 聚簇索引：innoDB独有，一张表只有一个，索引即数据本身，找到叶子节点就是找到数据，缓存时可以将数据一起缓存。

- 非聚簇索引：MyIsam或InnoDb的非聚簇索引，索引和数据分开。
  MyIsam查询方式为找到叶子节点，叶子节点中存放真实数据指针位置。
  二级索引叶子节点中存放主键，需要再去查主键索引，这个过程称为回表。
  
- 其他：InnoDb还支持自适应哈希，预读，二次写，插入缓存（多个插入操作一起执行）
自适应哈希用于二级索引频繁访问自动优化，hash索引只能等值查询。
  
- 唯一索引：一个表只能有一个主键索引，多个唯一索引，唯一可以为空值。

- 覆盖索引：当所有数据都在索引中时，形成覆盖索引。

- 联合索引：遵循最左匹配原则，同理还有like xx%，注意，顺序不影响联合索引的使用，sql会自动优化。

sql优化时尽量避免使用!= or，null值不走索引，表达式相关不走索引。

###6.char和varchar

char为固定长度，不足的位自动填充，varchar为可变长度。

int(11)这种只影响展示效果，不影响存储范围。

###7.drop delete truncate

delete和truncata删除数据但不改变表结构。
drop会删除表

delete可以回滚，truncate和drop不能回滚。

###8.explain

- type：const唯一或主键等值查询 ref非唯一查询 range范围查询 index全索引扫描 all全表扫描
- key：实际使用索引
- rows：查询目标扫描条数
- extra：filesort使用外部排序 where使用where条件 temper使用临时表 index覆盖索引

###9.大表优化

- 范围查询，限定某段时间
- 读写分离
- 垂直分表：相关性功能拆分，可以使数据量变小，但需要join等操作，影响性能
- 水平分表：分表分库，分片数据单表千万级以上可以考虑分成常规数据和历史数据

如果一开始就分片，则需要实现分布式id算法，水平分表尽量避免join groupby等，避免二次操作

- 客户端分片：封装在jar包中，修改JDBC实现
- 代理分片：统一维护在中间件中

分布式id算法：数据库本身实现，需要设置步长，redis，引入第三方，雪花算法，用时间戳和机器id生成唯一